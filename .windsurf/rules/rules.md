---
trigger: always_on
---

# RULES.md

## コーディングルール
- 言語はTypeScriptを使用する
- `any` の濫用を避ける（必要時は理由をコメント）
- 命名は分かりやすく、略語を避ける
- 1ファイル1責務を意識する

## ディレクトリルール
- `app/`: ページとRoute Handlers
- `lib/`: ドメインロジックと共通ユーティリティ
- `components/`: 再利用UI
- `prisma/`: スキーマとseed

## 認証/認可ルール
- 認証ロジックは `lib/auth/*` にのみ実装する
- ページ/APIで生のCookie解析を重複実装しない
- 保護対象ページは必ず認証ガードを通す
- Attempt系更新APIは所有者検証を必須とする

## API実装ルール
- 書き込み系は `POST` を使用する
- 入力はZodで必ず検証する
- エラーレスポンスは `message` を含むJSONで返す
- 期待しない例外は500で返し、詳細はサーバーログで確認する

## DBルール
- Prisma schema変更時はmigrationを必ず作成する
- seedは再実行可能（idempotent）にする
- 仕様に関係ないカラムを先回りで増やしすぎない

## UIルール
- Tailwindで実装し、ダークモードを崩さない
- フォームには入力バリデーションと具体的なエラーメッセージを出す
- MVPでは過度な装飾を避け、可読性と操作性を優先する

## セキュリティルール
- 平文パスワード保存禁止
- CookieはHTTP-only/SameSite=Laxを維持
- 状態変更APIでOriginチェックを実施
- ユーザー入力は必ず検証・サニタイズ方針を意識する

## PR/Issue運用ルール
- 1 Issue = 1責務で実装する
- 依存順に着手する（基盤→機能→統合）
- PRには以下を記載する
  - 目的
  - 変更内容
  - 動作確認手順
  - 未対応事項（あれば）

## MVPでやらないこと
- 管理画面
- 外部SaaS連携
- 本番向け運用最適化（監視/可観測性の作り込み等）
