---
alwaysApply: true
---
# Next.js（Vercel 準拠）Cursor Rules

## 0. 最優先の姿勢
- 事実と推測を区別する。コードと設定を確認してから提案する。確証がない断定はしない。
- 変更は最小差分。不要なリファクタや大規模置換はしない。
- 追加・変更したら「ビルド / lint / テスト」に影響が出ない形で完結させる（実行コマンドがあるならそれに合わせる）。

## 1. Next.js の前提
- App Router（`app/`）前提で考える。Server Components をデフォルトにする。
- `"use client"` は「ブラウザ API / hooks / インタラクション」が必要な最小範囲にだけ付ける。
- ルーティングは `app/**/page.tsx` / `layout.tsx` / `loading.tsx` / `error.tsx` の責務に従って分離する。

## 2. データ取得（ウォーターフォール禁止）
- `useEffect` での段階的フェッチは原則避ける（クライアント側の瀑布を作りやすい）。
- Server 側で取得できるものは Server 側で。複数取得は並列化（`Promise.all` 等）して待ちを短縮する。
- キャッシュ / 再検証（revalidate 等）の方針を壊さない。既存の fetch 設計があればそれに合わせる。

## 3. バンドルサイズ / クライアント負荷
- Client Component から重い依存を増やさない。必要なら dynamic import / 分割を検討する。
- 共有 UI は Server Component を基本にし、クライアント state が必要な部分だけを小さく切り出す。

## 4. レンダリング / UX
- 体感速度を優先し、必要なら `loading.tsx` + `Suspense` で段階表示を作る。
- 画像は原則 `next/image` を使い、サイズ指定・代替テキストを明示する。
- 内部遷移は `next/link` を使う。

## 5. 型安全 / 保守性
- TypeScript の型を「後付け」ではなく「最初に」設計する（props / 戻り値 / API）。
- 既存の lint / formatter / 命名規則に合わせる（勝手に流儀を変えない）。
- 例外処理とエラーメッセージを用意し、失敗時の挙動が読めるようにする。

## 6. アクセシビリティ（最低ライン）
- 入力フォームには label（または aria-label）を付ける。エラーはユーザーに伝わる形で表示する。
- ボタンは button、リンクは a / Link。div のクリックハンドラ濫用を避ける。
- キーボード操作とフォーカス可視性を壊さない。
